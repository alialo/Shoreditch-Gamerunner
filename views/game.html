<h1>{{game_name}}</h1>

<ul id="game">

</ul>

<script id="round" type="text/x-jquery-tmpl">
	<li id="round_${data.round}">
		<h1>Round ${data.round}</h1>
		<ul class="round_actions"></ul>
	</li>
</script>

<script id="turn" type="text/x-jquery-tmpl">
	<li class="turn_${data.turn}">
		<h2>${data.player.player}s turn</h2>
		<ul class="turn_actions"></ul>
	</li>
</script>

<script id="turn-skipped" type="text/x-jquery-tmpl">
	<li class="skipped turn_${data.turn}">
		<h2>${data.player.player}s skipped their turn</h2>
		<ul class="turn_actions"></ul>
	</li>
</script>

<script id="purchase-generator" type="text/x-jquery-tmpl">
	<li class="purchase_generator">
		Someone purchased something
	</li>
</script>

<script id="upgrade-generator" type="text/x-jquery-tmpl">
	<li class="upgrade_generator">
		Someone upgraded something
	</li>
</script>

<script id="purchase-road" type="text/x-jquery-tmpl">
	<li class="purchase_road">
		Someone purchased a road
	</li>
</script>

<script id="trade" type="text/x-jquery-tmpl">
	<li class="trade">
		Someone traded with someone else.
	</li>
</script>

<script id="end" type="text/x-jquery-tmpl">
	<li class="end_game">
		<h1>The game is over</h1>
	</li>
</script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>
<script src="http://js.pusher.com/1.11/pusher.min.js"></script>

<script>
	
	function add_to_turn(round, turn, el) {
		$('#round_' + round + ' .turn_' + turn + ' .turn_actions').append(el)
	}

	var pusher = new Pusher('b91e1271dbcde8bb5b5d');
	var channel = pusher.subscribe('game-{{game_id}}');

	channel.bind('new-round', function(data) {
		$('#game').append($('#round').tmpl({"data": data}));
	});

	channel.bind('start-turn', function(data) {
		$('#round_' + data.round + ' .round_actions').append($('#turn').tmpl({'data': data}));
	});

	channel.bind('turn-skipped', function(data) {
		$('#round_' + data.round + ' .round_actions').append($('#turn').tmpl({'data': data}));
	});

	channel.bind('purchase-generator', function(data) {
		add_to_turn(data.round, data.turn, $('#purchase_generator').tmpl({'data': data}))
	});
	channel.bind('upgrade-generator', function(data) {
		add_to_turn(data.round, data.turn, $('#upgrade_generator').tmpl({'data': data}))
	});
	channel.bind('purchase-road', function(data) {
		add_to_turn(data.round, data.turn, $('#purchase_road').tmpl({'data': data}))
	});
	channel.bind('trade', function(data) {
		add_to_turn(data.round, data.turn, $('#trade').tmpl({'data': data}))
	});
	channel.bind('end', function(data) {
		$('#game').append($('#end').tmpl({"data": data}));
	});

	var pushes = {{!pushes}}

	for (var i in pushes) {
		pusher.channels.channels['game-{{game_id}}'].emit(pushes[i][0], pushes[i][1]);
	}
</script>