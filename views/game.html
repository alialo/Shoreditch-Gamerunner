<style>
	body {
		background: #ACA3D8;
		max-width: 1412px;
		margin: auto;
	}
	
	ul {
		list-style: none;
		margin: 0;
		padding: 0;
	}

	.round {
		border-radius: 10px;
		border: 3px solid black;
		background: white;
		padding: 10px;
		margin-bottom: 10px;
	}

	h1, h2, h3 {
		margin: 0;
	}

	.players {
		display: -webkit-box;
		display: -moz-box;
		display: box;
	}

	.player {
		display: inline-block;
		border: 3px solid black;
		border-radius: 10px;
		padding: 10px;

		-webkit-box-flex: 1;
		-moz-box-flex: 1;
		box-flix: 1;
	}

	.generated {
		border: 1px solid black;
		border-radius: 10px;
		padding: 10px;
	}

	.generators, .improved_generators {
		border: 1px solid black;
		border-radius: 10px;
		padding: 10px;
		display: inline-block;
	}

	.resources {
		border: 1px solid black;
		border-radius: 10px;
		padding-left: 10px;
		padding-right: 10px;
	}
	.resources li {
		display: inline-block;
	}
</style>
<h1>Startups of Shoreditch</h1>

<ul id="game">

</ul>

<script id="round-generated" type="text/x-jquery-tmpl">
	<li class="round" id="round_${data.round}">
		<h1>Round ${data.round}</h1>
				<ul class="generated">{\\
			%pass
{each(id, player) data.generated}}
				{\\
					%pass
{each(resource,amount) resources}}
	<li>${name} got ${amount}x ${resource}</li>
{\\
%pass
{/each}}
{\\
%pass
{/each}}

		</ul>

		<ul class="players">{\\
			%pass
{each(id, player) data.players}}
				<li class="player player_${id}">
					<h3>${name}</h3>
					<ul class="generators">{\\
						%pass
{each(resource, amount) generators}}
						<li>${amount}x ${generator_names[resource]}</li>
						{\\
						%pass
{/each}}
					</ul>
					<ul class="improved_generators">{\\
						%pass
{each(resource, amount) improved_generators}}
						<li>${amount}x ${improved_generator_names[resource]}</li>
						{\\
						%pass
{/each}}
					</ul>

					<ul class="resources">{\\
						%pass
{each(resource, amount) resources}}
						<li>${amount}x ${resource_names[resource]}</li>
						{\\
						%pass
{/each}}
					</ul>
					<div class="score">
						<span class="customers">${customers} Customers</span>
						<span class="pr">${pr} PR</span>
					</div>
				</li>
				{\\
				%pass
{/each}}
		</ul>
		<ul class="round_actions"></ul>
	</li>
</script>

<script id="round" type="text/x-jquery-tmpl">
	<li class="round" id="round_${data.round}">
		<h1>Round ${data.round}</h1>
		<ul class="players">{\\
			%pass
{each(id, player) data.players}}
				<li class="player player_${id}">
					<h3>${name}</h3>
					<ul class="generators">{\\
						%pass
{each(resource, amount) generators}}
						<li>${amount}x ${generator_names[resource]}</li>
						{\\
						%pass
{/each}}
					</ul>
					<ul class="improved_generators">{\\
						%pass
{each(resource, amount) improved_generators}}
						<li>${amount}x ${improved_generator_names[resource]}</li>
						{\\
						%pass
{/each}}
					</ul>

					<ul class="resources">{\\
						%pass
{each(resource, amount) resources}}
						<li>${amount}x ${resource_names[resource]}</li>
						{\\
						%pass
{/each}}
					</ul>
					<div class="score">
						<span class="customers">${customers} customers</span>
						<span class="pr">${pr} PR</span>
					</div>
				</li>
				{\\
				%pass
{/each}}
		</ul>
		<ul class="round_actions"></ul>
	</li>
</script>

<script id="turn" type="text/x-jquery-tmpl">
	<li class="turn_${data.turn}">
		<h2>${data.player.name}s turn</h2>
		<ul class="turn_actions"></ul>
	</li>
</script>

<script id="turn-skipped" type="text/x-jquery-tmpl">
	<li class="skipped turn_${data.turn}">
		<h2>${data.player.name}s skipped their turn</h2>
		<ul class="turn_actions"></ul>
	</li>
</script>

<script id="purchase-generator" type="text/x-jquery-tmpl">
	<li class="purchase_generator generator_${data.generator_type}">
		${data.player.name} purchased a ${data.generator_type}
	</li>
</script>

<script id="upgrade-generator" type="text/x-jquery-tmpl">
	<li class="upgrade_generator upgrade_${data.generator_type}">
		${data.player.name} upgraded a ${data.generator_type}
	</li>
</script>

<script id="purchase-pr" type="text/x-jquery-tmpl">
	<li class="purchase_pr">
		${data.player.name} purchased a pr
	</li>
</script>

<script id="timeout" type="text/x-jquery-tmpl">
	<li class="purchase_pr">
		${data.player.name} ran out of time!
	</li>
</script>

<script id="trade" type="text/x-jquery-tmpl">
	<li class="trade pending" id="trade_${data.trade_id}">
		${data.player.name} is offering to trade.
		<ul class="offering">{\\
			% pass
{each(offer, amount) data.offering}}
				<li>${amount}x ${offer}</li>
			{\\
			% pass
{/each}}
		</ul>

		for

		<ul class="requesting">
			{\\
			% pass
{each(request, amount) data.requesting}}
				<li>${amount}x ${request}</li>
			{\\
			% pass
{/each}}
		</ul>

		<div class="result">
			The other players are considering the offer
		</div>
	</li>
</script>

<script id="trade-accepted" type="text/x-jquery-tmpl">
	The trade was accepted by ${data.player.name}
</script>

<script id="bank-trade-accepted" type="text/x-jquery-tmpl">
	The trade was accepted by the bank
</script>

<script id="end" type="text/x-jquery-tmpl">
	<li class="end_game">
		<h1>The game is over</h1>
		<ul class="players">{\\
			%pass
{each(id, player) data.players}}
				<li class="player_${id}">
					<h3>${name}</h3>
					<ul class="generators">{\\
						%pass
{each(resource, amount) generators}}
						<li>${amount}x ${resource}</li>
						{\\
						%pass
{/each}}
					</ul>
					<ul class="improved_generators">{\\
						%pass
{each(resource, amount) improved_generators}}
						<li>${amount}x ${resource}</li>
						{\\
						%pass
{/each}}
					</ul>

					<ul class="resources">{\\
						%pass
{each(resource, amount) resources}}
						<li>${amount}x ${resource}</li>
						{\\
						%pass
{/each}}
					</ul>
					<span class="customers">${customers} customers</span>
					<span class="pr">${pr} PR</span>
				</li>
				{\\
				%pass
{/each}}
		</ul>
	</li>
</script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>
<script src="http://js.pusher.com/1.11/pusher.min.js"></script>

<script>
	
	var resource_names = {{!resource_names}}
	var generator_names = {{!generator_names}}
	var improved_generator_names = {{!improved_generator_names}}

	function add_to_turn(round, turn, el) {
		$('#round_' + round + ' .turn_' + turn + ' .turn_actions').append(el)
	}

	var pusher = new Pusher('b91e1271dbcde8bb5b5d');
	var channel = pusher.subscribe('game-{{game_id}}');

	channel.bind('new-round', function(data) {
		data['generator_names'] = generator_names;
		data['improved_generator_names'] = improved_generator_names;
		data['resource_names'] = resource_names;
		if ('generated' in data) {
			$('#game').append($('#round-generated').tmpl({"data": data}));
		} else {
			$('#game').append($('#round').tmpl({"data": data}));
		}
	});

	channel.bind('start-turn', function(data) {
		$('#round_' + data.round + ' .round_actions').append($('#turn').tmpl({'data': data}));
	});

	channel.bind('turn-skipped', function(data) {
		$('#round_' + data.round + ' .round_actions').append($('#turn').tmpl({'data': data}));
	});

	channel.bind('purchase-generator', function(data) {
		add_to_turn(data.round, data.turn, $('#purchase-generator').tmpl({'data': data}))
	});

	channel.bind('upgrade-generator', function(data) {
		add_to_turn(data.round, data.turn, $('#upgrade-generator').tmpl({'data': data}))
	});
	channel.bind('purchase-pr', function(data) {
		add_to_turn(data.round, data.turn, $('#purchase-pr').tmpl({'data': data}))
	});
	channel.bind('timeout', function(data) {
		add_to_turn(data.round, data.turn, $('#timeout').tmpl({'data': data}))
	});
	channel.bind('trade', function(data) {
		add_to_turn(data.round, data.turn, $('#trade').tmpl({'data': data}))
	});
	channel.bind('trade-rejected', function(data) {
		var div = $('#trade_' + data.trade_id);
		div.removeClass('pending').addClass('rejected')
		div.find('.result').text('The trade was rejected')
	});
	channel.bind('trade-accepted', function(data) {
		var div = $('#trade_' + data.trade_id);
		div.removeClass('pending').addClass('accepted')
		div.find('.result').html($('#trade-accepted').tmpl({'data': data}))
	});
	channel.bind('bank-trade-accepted', function(data) {
		var div = $('#trade_' + data.trade_id);
		div.removeClass('pending').addClass('accepted').addClass('bank-accepted')
		div.find('.result').html($('#bank-trade-accepted').tmpl({'data': data}))
	});

	channel.bind('end', function(data) {
		$('#game').append($('#end').tmpl({"data": data}));
	});

	var pushes = {{!pushes}}

	for (var i in pushes) {
		pusher.channels.channels['game-{{game_id}}'].emit(pushes[i][0], pushes[i][1]);
	}
</script>